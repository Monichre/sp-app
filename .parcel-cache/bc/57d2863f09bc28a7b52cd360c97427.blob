var $ba07fdfb532228628e6726be90954c3$exports = {};

function $ba07fdfb532228628e6726be90954c3$var$_interopDefault(ex) {
  return ex && typeof ex === 'object' && 'default' in ex ? ex['default'] : ex;
}

var $ba07fdfb532228628e6726be90954c3$var$React = $parcel$require("3ba07fdfb532228628e6726be90954c3", "react");
var $ba07fdfb532228628e6726be90954c3$var$React__default = $ba07fdfb532228628e6726be90954c3$var$_interopDefault($ba07fdfb532228628e6726be90954c3$var$React);
var $ba07fdfb532228628e6726be90954c3$var$shallowEqual = $ba07fdfb532228628e6726be90954c3$var$_interopDefault($parcel$require("3ba07fdfb532228628e6726be90954c3", "shallowequal"));

function $ba07fdfb532228628e6726be90954c3$var$_defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

function $ba07fdfb532228628e6726be90954c3$var$_inheritsLoose(subClass, superClass) {
  subClass.prototype = Object.create(superClass.prototype);
  subClass.prototype.constructor = subClass;
  subClass.__proto__ = superClass;
}

var $ba07fdfb532228628e6726be90954c3$var$canUseDOM = !!(typeof window !== 'undefined' && window.document && window.document.createElement);

function $ba07fdfb532228628e6726be90954c3$var$withSideEffect(reducePropsToState, handleStateChangeOnClient, mapStateOnServer) {
  if (typeof reducePropsToState !== 'function') {
    throw new Error('Expected reducePropsToState to be a function.');
  }

  if (typeof handleStateChangeOnClient !== 'function') {
    throw new Error('Expected handleStateChangeOnClient to be a function.');
  }

  if (typeof mapStateOnServer !== 'undefined' && typeof mapStateOnServer !== 'function') {
    throw new Error('Expected mapStateOnServer to either be undefined or a function.');
  }

  function getDisplayName(WrappedComponent) {
    return WrappedComponent.displayName || WrappedComponent.name || 'Component';
  }

  return function wrap(WrappedComponent) {
    if (typeof WrappedComponent !== 'function') {
      throw new Error('Expected WrappedComponent to be a React component.');
    }

    var mountedInstances = [];
    var state;

    function emitChange() {
      state = reducePropsToState(mountedInstances.map(function (instance) {
        return instance.props;
      }));

      if (SideEffect.canUseDOM) {
        handleStateChangeOnClient(state);
      } else if (mapStateOnServer) {
        state = mapStateOnServer(state);
      }
    }

    var SideEffect =
    /*#__PURE__*/
    function (_Component) {
      $ba07fdfb532228628e6726be90954c3$var$_inheritsLoose(SideEffect, _Component);

      function SideEffect() {
        return _Component.apply(this, arguments) || this;
      } // Try to use displayName of wrapped component
      // Expose canUseDOM so tests can monkeypatch it


      SideEffect.peek = function peek() {
        return state;
      };

      SideEffect.rewind = function rewind() {
        if (SideEffect.canUseDOM) {
          throw new Error('You may only call rewind() on the server. Call peek() to read the current state.');
        }

        var recordedState = state;
        state = undefined;
        mountedInstances = [];
        return recordedState;
      };

      var _proto = SideEffect.prototype;

      _proto.shouldComponentUpdate = function shouldComponentUpdate(nextProps) {
        return !$ba07fdfb532228628e6726be90954c3$var$shallowEqual(nextProps, this.props);
      };

      _proto.componentWillMount = function componentWillMount() {
        mountedInstances.push(this);
        emitChange();
      };

      _proto.componentDidUpdate = function componentDidUpdate() {
        emitChange();
      };

      _proto.componentWillUnmount = function componentWillUnmount() {
        var index = mountedInstances.indexOf(this);
        mountedInstances.splice(index, 1);
        emitChange();
      };

      _proto.render = function render() {
        return $ba07fdfb532228628e6726be90954c3$var$React__default.createElement(WrappedComponent, this.props);
      };

      return SideEffect;
    }($ba07fdfb532228628e6726be90954c3$var$React.Component);

    $ba07fdfb532228628e6726be90954c3$var$_defineProperty(SideEffect, "displayName", "SideEffect(" + getDisplayName(WrappedComponent) + ")");
    $ba07fdfb532228628e6726be90954c3$var$_defineProperty(SideEffect, "canUseDOM", $ba07fdfb532228628e6726be90954c3$var$canUseDOM);
    return SideEffect;
  };
}

$ba07fdfb532228628e6726be90954c3$exports = $ba07fdfb532228628e6726be90954c3$var$withSideEffect;